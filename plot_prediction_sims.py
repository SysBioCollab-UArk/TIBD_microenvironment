import os
import sys
# import the run_<...>_pydream file from the directory where you ran PyDREAM from
dirpath = os.path.join('MODELS', 'SAVE', 'Leonard', 'Bennett2024_Johnson2011_stderr_2abs')
sys.path.insert(0, dirpath)
from run_tibd_pydream import *

# create the ParameterCalibration object
calibrator = ParameterCalibration(model,
                                  expt_data_file,
                                  sim_protocols,
                                  priors=custom_priors,
                                  no_sample=no_sample,
                                  param_expts_map=param_expts_map)

#### Create plots using output files already generated by PyDREAM and the 'create_figures' function ####
kwargs = {'obs_labels': obs_labels, 'show_plots': True,
          'plot_ll_args': {'cutoff': 2, 'fontsizes': {'labels': 14, 'ticks': 14, 'legend': 14}, 'leg_ncols': 2},
          'plot_pd_args': {'sharex': 'all', 'fontsize': 28, 'labelsize': 24, 'bw_adjust': 3},
          'plot_tc_args': {'separate_plots': False, 'save_sim_data': True},
          'which_plots': 2}

_, (param_samples, param_groups, param_labels), _ = plot_pydream_output(dirpath, calibrator, **kwargs)

#### Run drug prediction simulations using the 'plot_timecourses' function ####
sim_protocols = [tumor_injection, tumor_bisphos_injection]
tspans = [np.linspace(0, 28, 281)] * len(sim_protocols)
samples_idxs = [calibrator.samples_idxs[0]] * len(sim_protocols)
# plot all observables for all experiments, even if there's no data for them
observables = [calibrator.observables[0]] * len(sim_protocols)
xlabel = 'time (day)'
ylabels = [['amount (relative % BV/TV)'] + ['amount (fM)'] * 3] * len(sim_protocols)
leg_labels = [['bone density: -ZA', 'osteoclasts: -ZA', 'osteoblasts: -ZA', 'tumor cells: -ZA'],
              ['bone density: +ZA', 'osteoclasts: +ZA', 'osteoblasts: +ZA', 'tumor cells: +ZA']]

calibrator.plot_timecourses(model, tspans, sim_protocols, param_samples, calibrator.parameter_idxs,
                            observables=observables, exp_data=calibrator.raw_data, samples_idxs=samples_idxs,
                            show_plot=True, xlabel=xlabel, ylabels=ylabels, leg_labels=leg_labels,
                            **kwargs['plot_tc_args'])
